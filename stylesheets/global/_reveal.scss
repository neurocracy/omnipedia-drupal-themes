// -----------------------------------------------------------------------------
//   Reveal animations for the site
// -----------------------------------------------------------------------------

@use 'sass/helpers/colour';

///
/// Reveal overlay animation duration.
///
$reveal-overlay-animation-duration: 0.5s;

///
/// Site reveal overlay animation delay.
///
/// This should be just long enough that most browsers will have already done
/// most of their layout rendering and most DOMContentLoaded JavaScript has
/// (hopefully) finished executing so the reveal animation has a better chance
/// of playing smoothly and without too many frames dropped.
///
$site-reveal-overlay-animation-delay: 0.3s;

///
/// Site reveal overlay keyframes.
///
@keyframes reveal-overlay {
  0% {
    opacity:        1;
    pointer-events: auto;
    visibility:     visible;
  }
  1% {
    pointer-events: none;
  }
  99% {
    opacity:    0;
  }
  100% {
    visibility: hidden;
  }
}

.layout-container::before {
  @supports (pointer-events: none) and (width: 100vw) {
    content: '';

    display:  block;

    position: fixed;

    top:      0;
    bottom:   0;
    left:     50%;

    margin-left:  -50vw;

    width:    100vw;

    background-color: colour.$background-light;

    @include colour.on-dark-scheme {
      background-color: colour.$background-dark;
    }

    // Default to hidden and click-through in case animations are not properly
    // supported or running.
    visibility: hidden;
    pointer-events: none;
    opacity: 0;

    // Default transition in animation; plays on a full load and triggered
    // during a RefreshLess visit.
    animation-name:             reveal-overlay;
    animation-duration:         $reveal-overlay-animation-duration;
    animation-timing-function:  linear;
    animation-fill-mode:        backwards;
    animation-delay:            $site-reveal-overlay-animation-delay;
    animation-iteration-count:  1;

    // Resets the animation-name and animation-delay in preparation for
    // transitioning out; this is necessary so the browser plays the animation
    // again but in reverse. The removal of the delay is also ideal, as it's not
    // needed after the full page load.
    html.refreshless--page-transition-in-progress & {
      animation-delay: 0s;
      animation-name: none;
    }

    // Transition out animation; reverses the animation and plays it faster.
    html.refreshless--page-transition-out & {

      animation-name:       reveal-overlay;
      animation-fill-mode:  forwards;
      animation-direction:  reverse;
      animation-duration:   $reveal-overlay-animation-duration * 0.3;
    }

  }
}
